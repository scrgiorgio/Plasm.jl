xLast login: Fri Jul  5 19:16:18 on ttys001

The default interactive shell is now zsh.
To update your account to use zsh, please run `chsh -s /bin/zsh`.
For more details, please visit https://support.apple.com/kb/HT208050.
(base) ✔ ~ 
17:04 $ julia
               _
   _       _ _(_)_     |  Documentation: https://docs.julialang.org
  (_)     | (_) (_)    |
   _ _   _| |_  __ _   |  Type "?" for help, "]?" for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.10.4 (2024-06-04)
 _/ |\__'_|_|_|\__'_|  |  Official https://julialang.org/ release
|__/                   |

julia> using SparseArrays, NearestNeighbors

julia> V = Any[0.0 0.0; 0.49239062300930003 -3.8448000006777085e-8; 0.0 0.0; 0.0 0.0; 0.290452811538168 -2.267981797000424e-8; 0.49239062300930003 -3.8448000006777085e-8; 0.4923906230093 -3.844800000677708e-8; -3.8448000005963934e-8 0.49239043606770005; 0.49239058669239005 0.49239048641521005; -3.8448000005963934e-8 0.49239043606770005; -3.8448000005963934e-8 0.49239043606770005; 0.11856621459843392 0.49239044819123634; 0.3733588299665283 0.49239047424407545; 0.44520597655557403 0.49239048159052917; 0.49239058669239005 0.49239048641521005; 0.0 0.0; -3.8448000005963934e-8 0.49239043606770005; -3.8448000005963934e-8 0.49239043606770005; -3.8448000005963934e-8 0.49239043606770005; 0.0 0.0; 0.0 0.0; 0.49239062300930003 -3.8448000006777085e-8; 0.49239058669239005 0.49239048641521005; 0.49239058669239005 0.49239048641521016; 0.49239058669239005 0.4923904864152088; 0.49239062300930003 -3.8448000006777085e-8; 0.49239062300930003 -3.8448000006777085e-8; 0.49239059535275914 0.37497180473230984; 0.4923905904340253 0.4416607920584202; 0.49239058669239044 0.4923904864152088; 0.41005460636210334 0.8968732108455488; 0.45037827038091527 0.43287349800018576; 0.4452059765555741 0.49239048159052917; 0.4452059765555742 0.49239048159052806; 0.41523199090429797 0.8372976489683448; 0.4411779421521642 0.5387406050724006; 0.4380651848685981 0.5745587411688174; 0.43866506138387895 0.5676560318638508; 0.45037827038091527 0.43287349800018576; 0.9855392464859788 0.544807732043488; 0.45037827038091527 0.43287349800018576; 0.45037827038091527 0.43287349800018576; 0.4923905904340252 0.4416607920584201; 0.4923905904340258 0.44166079205842024; 0.43168697417543267 0.8550140412896051; 0.10634620884900947 0.5047332453964272; 0.10634620884900947 0.5047332453964272; 0.41523199090429797 0.8372976489683448; 0.10634620884900947 0.5047332453964272; 0.22139247175761884 0.38853095209039384; 0.11856621459843392 0.49239044819123634; 0.11856621459843422 0.492390448191236; 0.10634620884900947 0.5047332453964272; 0.2213924717576188 0.3885309520903939; 0.19277481689508144 0.33748928199604766; 0.6735888623979135 0.3976400640584811; 0.19277481689508144 0.33748928199604766; 0.4923905953527592 0.3749718047323099; 0.4923905953527594 0.3749718047323099; 0.19277481689508144 0.33748928199604766; 0.19539306723690206 0.15487367096062127; 0.19277481689508144 0.33748928199604766; 0.19539306723690206 0.15487367096062127; 0.6222760387661216 0.6625098524173315; 0.22139247175761884 0.38853095209039384; 0.37335882996652825 0.49239047424407545; 0.3733588299665269 0.49239047424407456; 0.22139247175761884 0.38853095209039384; 0.4411779421521642 0.5387406050724006; 0.4653419248442575 0.5552551792538822; 0.47309890166372 0.596547323141818; 0.4320021315493107 0.5707533229285129; 0.4380651848685981 0.5745587411688176; 0.4320021315493107 0.5707533229285129; 0.5003406931709782 0.5389858540314958; 0.4320021315493107 0.5707533229285129; 0.4653419248442575 0.5552551792538822; 0.43866506138387895 0.5676560318638507; 0.4320021315493107 0.5707533229285129; 0.49239058669239044 0.4923904864152088; 0.49239062300930003 -3.8448000006777085e-8; 0.49239058669239044 0.4923904864152088; 0.49239062300930003 -3.8448000005963934e-8; 0.49239062300930003 -3.8448000005963934e-8; 0.4923905953527595 0.37497180473230995; 0.49239059043402567 0.44166079205842024; 0.49239062300930003 -3.8448000006777085e-8; 0.49239058669239044 0.4923904864152088; -3.8448000005963934e-8 0.49239043606770005; -3.8448000005963934e-8 0.49239043606770005; -3.8448000005963934e-8 0.49239043606770005; 0.49239058669239005 0.49239048641521005; 0.1185662145984342 0.492390448191236; 0.3733588299665269 0.4923904742440745; 0.4452059765555742 0.492390481590528; 0.49239058669239005 0.4923904864152088; 0.49239058669239044 0.4923904864152088; 0.49239062300930003 -3.8448000006777085e-8; 0.0 0.0; 0.0 0.0; 0.0 0.0; 0.29045281153816804 -2.2679817970004244e-8; 0.49239062300930003 -3.8448000006777085e-8; 0.49239062300930003 -3.8448000006777085e-8; -3.8448000005963934e-8 0.49239043606770005; 0.0 0.0; -3.8448000005963934e-8 0.49239043606770005; -3.8448000005963934e-8 0.49239043606770005; 0.0 0.0; 0.0 0.0; 0.19539306723690206 0.15487367096062127; 0.34723304211237405 -0.09250778292492912; 0.29045281153816804 -2.267981794035201e-8; 0.29045281153816804 -2.2679817968107585e-8; 0.19539306723690206 0.15487367096062127]
115×2 Matrix{Any}:
  0.0         0.0
  0.492391   -3.8448e-8
  0.0         0.0
  0.0         0.0
  0.290453   -2.26798e-8
  0.492391   -3.8448e-8
  0.492391   -3.8448e-8
 -3.8448e-8   0.49239
  0.492391    0.49239
 -3.8448e-8   0.49239
 -3.8448e-8   0.49239
  0.118566    0.49239
  0.373359    0.49239
  0.445206    0.49239
  0.492391    0.49239
  0.0         0.0
 -3.8448e-8   0.49239
 -3.8448e-8   0.49239
  ⋮          
  0.0         0.0
  0.0         0.0
  0.0         0.0
  0.290453   -2.26798e-8
  0.492391   -3.8448e-8
  0.492391   -3.8448e-8
 -3.8448e-8   0.49239
  0.0         0.0
 -3.8448e-8   0.49239
 -3.8448e-8   0.49239
  0.0         0.0
  0.0         0.0
  0.195393    0.154874
  0.347233   -0.0925078
  0.290453   -2.26798e-8
  0.290453   -2.26798e-8
  0.195393    0.154874

julia> EV = sparse([1, 2, 4, 1, 2, 3, 3, 4, 5, 8, 5, 6, 6, 7, 7, 8, 9, 9, 10, 11, 14, 15, 15, 10, 11, 12, 12, 13, 13, 14, 16, 22, 20, 21, 21, 22, 16, 17, 19, 20, 17, 18, 18, 19, 23, 25, 24, 25, 23, 24, 26, 27, 26, 27, 28, 29, 32, 29, 30, 30, 31, 28, 31, 32, 33, 35, 33, 34, 34, 35, 36, 36, 37, 41, 39, 40, 40, 41, 38, 39, 37, 38, 42, 43, 42, 43, 44, 46, 44, 45, 45, 46, 47, 48, 51, 47, 49, 50, 48, 49, 50, 51, 52, 53, 58, 53, 54, 57, 58, 56, 57, 55, 56, 54, 55, 52, 59, 60, 61, 60, 61, 59, 62, 63, 63, 62, 64, 65, 67, 65, 66, 66, 67, 64], [1, 1, 2, 4, 5, 5, 7, 7, 8, 9, 12, 12, 13, 13, 14, 14, 16, 17, 22, 22, 23, 23, 24, 26, 28, 28, 29, 29, 30, 30, 31, 32, 33, 33, 34, 34, 35, 35, 36, 36, 37, 37, 38, 38, 40, 41, 43, 43, 44, 44, 45, 46, 48, 48, 49, 49, 50, 51, 51, 52, 52, 53, 54, 54, 55, 56, 58, 58, 59, 59, 60, 61, 64, 65, 66, 66, 67, 67, 69, 69, 70, 70, 71, 72, 73, 73, 75, 76, 77, 77, 78, 78, 80, 80, 81, 82, 85, 85, 86, 86, 87, 87, 88, 88, 89, 92, 92, 93, 93, 94, 94, 95, 95, 96, 96, 97, 98, 98, 99, 102, 102, 103, 105, 105, 106, 108, 111, 111, 112, 113, 113, 114, 114, 115], Int8[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], 67, 115)
67×115 SparseMatrixCSC{Int8, Int64} with 134 stored entries:
⎡⠣⠱⢠⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎤
⎢⠀⠀⠀⠂⠙⠢⠄⠀⡀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⢡⡀⠘⢆⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⠹⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⠢⠖⡀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⢙⢦⡁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠜⢆⡀⡀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠆⢋⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠢⠲⡀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠡⠀⠋⡆⢀⠀⢀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠈⡤⠞⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠓⠐⢡⡀⠄⠀⠀⎥
⎣⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⠎⎦

julia> edge_map = [[1, 2, 3, 4], [5, 6, 7, 8], [9], [10, 11, 12, 13, 14, 15], [16, 17, 18, 19, 20, 21, 22], [23, 24, 25], [26, 27], [28, 29, 30, 31, 32], [33, 34, 35], [36], [37, 38, 39, 40, 41], [42, 43], [44, 45, 46], [47, 48, 49, 50, 51], [52, 53, 54, 55, 56, 57, 58], [59, 60, 61], [62, 63], [64, 65, 66, 67]]
18-element Vector{Vector{Int64}}:
 [1, 2, 3, 4]
 [5, 6, 7, 8]
 [9]
 [10, 11, 12, 13, 14, 15]
 [16, 17, 18, 19, 20, 21, 22]
 [23, 24, 25]
 [26, 27]
 [28, 29, 30, 31, 32]
 [33, 34, 35]
 [36]
 [37, 38, 39, 40, 41]
 [42, 43]
 [44, 45, 46]
 [47, 48, 49, 50, 51]
 [52, 53, 54, 55, 56, 57, 58]
 [59, 60, 61]
 [62, 63]
 [64, 65, 66, 67]

julia> err = 0.0001
0.0001

julia> vertsnum = size(V, 1)
115

julia> edgenum = size(EV, 1)
67

julia> newverts = zeros(Int, vertsnum)
       # NearestNeighbors.KDTree constructor needs an explicit array of Float64
115-element Vector{Int64}:
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 ⋮
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0

julia> V = Array{Float64,2}(V)
115×2 Matrix{Float64}:
  0.0         0.0
  0.492391   -3.8448e-8
  0.0         0.0
  0.0         0.0
  0.290453   -2.26798e-8
  0.492391   -3.8448e-8
  0.492391   -3.8448e-8
 -3.8448e-8   0.49239
  0.492391    0.49239
 -3.8448e-8   0.49239
 -3.8448e-8   0.49239
  0.118566    0.49239
  0.373359    0.49239
  0.445206    0.49239
  0.492391    0.49239
  0.0         0.0
 -3.8448e-8   0.49239
 -3.8448e-8   0.49239
  ⋮          
  0.0         0.0
  0.0         0.0
  0.0         0.0
  0.290453   -2.26798e-8
  0.492391   -3.8448e-8
  0.492391   -3.8448e-8
 -3.8448e-8   0.49239
  0.0         0.0
 -3.8448e-8   0.49239
 -3.8448e-8   0.49239
  0.0         0.0
  0.0         0.0
  0.195393    0.154874
  0.347233   -0.0925078
  0.290453   -2.26798e-8
  0.290453   -2.26798e-8
  0.195393    0.154874

julia> kdtree = NearestNeighbors.KDTree(permutedims(V))

       # merge congruent vertices
KDTree{StaticArrays.SVector{2, Float64}, Euclidean, Float64, StaticArrays.SVector{2, Float64}}
  Number of points: 115
  Dimensions: 2
  Metric: Euclidean(0.0)
  Reordered: true

julia> todelete = []
Any[]

julia> i = 1
1

julia> vi=1
1

julia> !(vi in todelete)
true

julia> for vi in 1:vertsnum
           if !(vi in todelete)
               nearvs = NearestNeighbors.inrange(kdtree, V[vi, :], err)
               newverts[nearvs] .= i
               nearvs = setdiff(nearvs, vi)
               todelete = union(todelete, nearvs)
               i = i + 1
           end
       end
ERROR: MethodError: no method matching setindex(::StaticArrays.SVector{2, Float64}, ::Float64, ::UInt16)

Closest candidates are:
  setindex(::StaticArrays.StaticArray, ::Any, ::Int64)
   @ StaticArrays ~/.julia/packages/StaticArrays/WNOVH/src/deque.jl:185
  setindex(::StaticArrays.StaticArray, ::Any, ::Int64...)
   @ StaticArrays ~/.julia/packages/StaticArrays/WNOVH/src/deque.jl:198
  setindex(::CartesianIndex, ::Any, ::Any)
   @ Base multidimensional.jl:105
  ...

Stacktrace:
 [1] inrange_kernel!(tree::KDTree{…}, index::Int64, point::Vector{…}, r::Float64, idx_in_ball::Vector{…}, hyper_rec::NearestNeighbors.HyperRectangle{…}, min_dist::Float64)
   @ NearestNeighbors ~/.julia/packages/NearestNeighbors/Qu8Ho/src/kd_tree.jl:254
 [2] _inrange(tree::KDTree{…}, point::Vector{…}, radius::Float64, idx_in_ball::Vector{…})
   @ NearestNeighbors ~/.julia/packages/NearestNeighbors/Qu8Ho/src/kd_tree.jl:213
 [3] inrange_point!(tree::KDTree{…}, point::Vector{…}, radius::Float64, sortres::Bool, idx::Vector{…})
   @ NearestNeighbors ~/.julia/packages/NearestNeighbors/Qu8Ho/src/inrange.jl:25
 [4] inrange(tree::KDTree{…}, point::Vector{…}, radius::Float64, sortres::Bool)
   @ NearestNeighbors ~/.julia/packages/NearestNeighbors/Qu8Ho/src/inrange.jl:41
 [5] inrange(tree::KDTree{…}, point::Vector{…}, radius::Float64)
   @ NearestNeighbors ~/.julia/packages/NearestNeighbors/Qu8Ho/src/inrange.jl:38
 [6] top-level scope
   @ ./REPL[14]:3
Some type information was truncated. Use `show(err)` to see complete types.

julia> 
